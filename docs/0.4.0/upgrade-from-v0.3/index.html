<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.26" />
    <meta name="description" content="">


    <title>Upgrading from Fission v0.3 to v0.4.x :: Fission: Serverless Functions for Kubernetes</title>
    <link rel="shortcut icon" href="/docs/0.3.0/images/favicon.png" type="image/x-icon" />
    <link href="/docs/0.3.0/css/nucleus.css" rel="stylesheet">
    <link href="/docs/0.3.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="/docs/0.3.0/css/hybrid.css" rel="stylesheet">
    <link href="/docs/0.3.0/css/featherlight.min.css" rel="stylesheet">
    <link href="/docs/0.3.0/css/horsey.css" rel="stylesheet">
    
    <link href="/docs/0.3.0/css/theme.css" rel="stylesheet">
    
    
    <link rel="stylesheet" href="/docs/0.3.0/css/bootstrap.min.css">
    <script src="/docs/0.3.0/js/jquery-2.x.min.js"></script>
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left {
        display:none !important;
      }
    </style>

    

    

  </head>
  <body class="" data-url="/docs/0.3.0/upgrade-from-v0.3/">
    <nav id="sidebar" class="">





<div class="highlightable">
  <div id="header-wrapper">
    <div id="header">
       
	<p><img src="http://fission.io/img/fission-logo-whitebg.png" alt="fission" /></p>
 


    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>
<script type="text/javascript" src="/docs/0.3.0/js/lunr.min.js"></script>
<script type="text/javascript" src="/docs/0.3.0/js/horsey.js"></script>
<script type="text/javascript">
    var baseurl = "http:\/\/fission.io\/docs\/0.3.0";
</script>
<script type="text/javascript" src="/docs/0.3.0/js/search.js"></script>

    
  </div>

  
    <ul class="topics">
        
            <li data-nav-id="/docs/0.3.0/" class="dd-item">
            <a href="/docs/0.3.0/"><i class="fa fa-fw fa-home"></i></a>
            </li>
        
        
        
          
        

        
    </ul>
    
     
    <section id="footer">
      
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
        
          <div id="top-bar">
            

            <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                <span id="sidebar-toggle-span">
                  <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                    <i class="fa fa-bars"></i>
                  </a>
                </span>
                <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                <span class="links">
                

 Upgrading from Fission v0.3 to v0.4.x

   
                </span>
            </div>
            <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#how-to-upgrade">How to Upgrade</a>
<ul>
<li><a href="#get-the-new-cli">Get the new CLI</a>
<ul>
<li><a href="#os-x">OS X</a></li>
<li><a href="#linux">Linux</a></li>
<li><a href="#windows">Windows</a></li>
</ul></li>
<li><a href="#get-fission-state-from-v0-3-install">Get Fission state from v0.3 install</a></li>
<li><a href="#upgrade-to-fission-0-4-0">Upgrade to Fission 0.4.0</a></li>
<li><a href="#upgrade-kubernetes-cluster-version">Upgrade Kubernetes cluster version</a></li>
<li><a href="#remove-all-tpr-definition-for-kubernetes-1-7-x">Remove all TPR definition (for Kubernetes 1.7.x)</a></li>
<li><a href="#restore-your-fission-state-into-fission-0-4-0">Restore your Fission state into Fission 0.4.0</a></li>
<li><a href="#verify">Verify</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

          </div>
        
        
        <div id="body-inner">
          
            <h1>Upgrading from Fission v0.3 to v0.4.x</h1>
          






<h2 id="introduction">Introduction</h2>

<p>Kubernetes ThirdPartyResources (&ldquo;TPR&rdquo;) are replaced by
CustomResourceDefinitions (&ldquo;CRD&rdquo;). TPRs have been deprecated and are
removed in Kubernetes 1.8.</p>

<p>Since Fission stores state in TPRs, we need to migrate this state from
TPRs to CRDs while upgrading.</p>

<p>Follow the instructions below if you&rsquo;re upgrading a Fission 0.2.1 or
0.3.0 cluster to 0.4. If you&rsquo;re using a pre-0.2 Fission cluster, use
the [upgrade guide from 0.1 to 0.2]() and then upgrade to 0.4.0.</p>

<h2 id="how-to-upgrade">How to Upgrade</h2>

<ol>
<li>Get the 0.4.0 CLI</li>
<li>Get the Fission state from v0.3 install</li>
<li>Upgrade to Fission 0.4.0</li>
<li>Upgrade Kubernetes cluster version to 1.7.x or higher</li>
<li>Remove all TPR definition (for Kubernetes 1.7.x)</li>
<li>Restore Fission state into CRDs</li>
</ol>

<h3 id="get-the-new-cli">Get the new CLI</h3>

<h4 id="os-x">OS X</h4>

<pre><code>$ curl -Lo fission https://github.com/fission/fission/releases/download/0.4.0/fission-cli-osx &amp;&amp; chmod +x fission &amp;&amp; sudo mv fission /usr/local/bin/
</code></pre>

<h4 id="linux">Linux</h4>

<pre><code>$ curl -Lo fission https://github.com/fission/fission/releases/download/0.4.0/fission-cli-linux &amp;&amp; chmod +x fission &amp;&amp; sudo mv fission /usr/local/bin/
</code></pre>

<h4 id="windows">Windows</h4>

<p>For Windows, you can use the linux binary on WSL. Or you can download
this windows executable: <a href="https://github.com/fission/fission/releases/download/0.4.0/fission-cli-windows.exe">fission.exe</a></p>

<h3 id="get-fission-state-from-v0-3-install">Get Fission state from v0.3 install</h3>

<pre><code>fission --server &lt;your v0.3 server&gt; tpr2crd dump --file state.json
</code></pre>

<p>You can skip the &ndash;server argument if you have the environment
variable <code>$FISSION_URL</code> set to point at a v0.3 Fission server.</p>

<p>This will create a JSON file with all your fission state in the
current directory.</p>

<h3 id="upgrade-to-fission-0-4-0">Upgrade to Fission 0.4.0</h3>

<p>Upgrade fission with a command similar to this:</p>

<pre><code>helm upgrade fission-all --namespace fission
</code></pre>

<h3 id="upgrade-kubernetes-cluster-version">Upgrade Kubernetes cluster version</h3>

<p>Since CustomResource is only supported on Kubernetes v1.7+ and higher, please make sure
that you upgrade to the right version that supports CustomResource.</p>

<h3 id="remove-all-tpr-definition-for-kubernetes-1-7-x">Remove all TPR definition (for Kubernetes 1.7.x)</h3>

<p>** NOTICE **: This step will remove TPR definition from your kubernetes cluster. Please make sure that you dump all TPRs at the second step!</p>

<p>Though Kubernetes will migrate TPRs to CRDs automatically when TPR definition is deleted if the same name CRD exists. We still need to make sure that there is no resource gets lost during the migration. Also, since we changed the capitalization of some CRDs to CamelCase (e.g. Httptrigger -&gt; HTTPTrigger), we need to recreate those resources by ourselves.</p>

<pre><code>fission tpr2crd delete
</code></pre>

<h3 id="restore-your-fission-state-into-fission-0-4-0">Restore your Fission state into Fission 0.4.0</h3>

<pre><code>fission tpr2crd restore --file state.json
</code></pre>

<p>This commands needs <code>$FISSION_URL</code> set to point to new fission installation.</p>

<p>It uses the file created in the first step.  It doesn&rsquo;t modify state.json.</p>

<p>(Note that you can run this restore on any cluster; it doesn&rsquo;t have the be the same kubernetes
cluster as your old install.)</p>

<h3 id="verify">Verify</h3>

<p>Let&rsquo;s check the migration result, first run following command to check CRD established state.</p>

<pre><code>kubectl get crd -o 'custom-columns=NAME:{.metadata.name},ESTABLISHED:{.status.conditions[?(@.type==&quot;Established&quot;)].status}'
</code></pre>

<p>The output should be like this</p>

<pre><code>NAME                                 ESTABLISHED
environments.fission.io              True
functions.fission.io                 True
httptriggers.fission.io              True
kuberneteswatchtriggers.fission.io   True
messagequeuetriggers.fission.io      True
packages.fission.io                  True
timetriggers.fission.io              True
</code></pre>

<p>And check that CRD resources you expect are there.</p>

<pre><code>COMMAND:
   fission [resource] list

RESOURCES:
    environments
    functions
    httptriggers
    kuberneteswatchtriggers
    messagequeuetriggers
    packages
    timetriggers
</code></pre>


<footer class=" footline" >
	
</footer>




        

      </div>
    </div>

    
 
    

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
            
        
        
        


        
        
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>    

    <script src="/docs/0.3.0/js/clipboard.min.js"></script>
<script src="/docs/0.3.0/js/featherlight.min.js"></script>
<script src="/docs/0.3.0/js/html5shiv-printshiv.min.js"></script>
<script src="/docs/0.3.0/js/highlight.pack.js"></script>

<script src="/docs/0.3.0/js/modernizr.custom.71422.js"></script>
<script src="/docs/0.3.0/js/learn.js"></script>
<script src="/docs/0.3.0/js/hugo-learn.js"></script>


<link href="/docs/0.3.0/mermaid/mermaid.css" type="text/css" rel="stylesheet"/>
<script src="/docs/0.3.0/mermaid/mermaid.js"></script>
<script>mermaid.initialize({startOnLoad:true});</script>

    

  </body>
</html>

